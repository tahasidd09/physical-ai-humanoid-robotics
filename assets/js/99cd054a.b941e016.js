"use strict";(globalThis.webpackChunkphysical_ai_textbook=globalThis.webpackChunkphysical_ai_textbook||[]).push([[448],{7592:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"module1/week3-ros-fundamentals","title":"ROS 2 Architecture","description":"Understanding ROS 2 architecture, nodes, topics, services, and the communication patterns for robot control","source":"@site/docs/module1/week3-ros-fundamentals.md","sourceDirName":"module1","slug":"/module1/week3-ros-fundamentals","permalink":"/physical-ai-and-humanoid-robotics/docs/module1/week3-ros-fundamentals","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"ROS 2 Architecture","description":"Understanding ROS 2 architecture, nodes, topics, services, and the communication patterns for robot control","keywords":["ros2","nodes","topics","services","dds","middleware"]},"sidebar":"tutorialSidebar","previous":{"title":"Sensors and Embodiment","permalink":"/physical-ai-and-humanoid-robotics/docs/module1/week2-intro-physical-ai-2"},"next":{"title":"ROS 2 Communication Patterns","permalink":"/physical-ai-and-humanoid-robotics/docs/module1/week4-ros-fundamentals-2"}}');var r=s(4848),t=s(8453);const o={sidebar_position:3,title:"ROS 2 Architecture",description:"Understanding ROS 2 architecture, nodes, topics, services, and the communication patterns for robot control",keywords:["ros2","nodes","topics","services","dds","middleware"]},l="Week 3: ROS 2 Architecture",a={},d=[{value:"Learning Outcomes",id:"learning-outcomes",level:2},{value:"The Physics (Why)",id:"the-physics-why",level:2},{value:"The Analogy (Mental Model)",id:"the-analogy-mental-model",level:2},{value:"The Visualization (ROS 2 Graph)",id:"the-visualization-ros-2-graph",level:2},{value:"The Code (Implementation)",id:"the-code-implementation",level:2},{value:"Your First ROS 2 Node",id:"your-first-ros-2-node",level:3},{value:"Publisher Node",id:"publisher-node",level:3},{value:"Subscriber Node",id:"subscriber-node",level:3},{value:"ROS 2 Command-Line Tools",id:"ros-2-command-line-tools",level:3},{value:"The Hardware Reality (Warning)",id:"the-hardware-reality-warning",level:2},{value:"Quality of Service (QoS) Settings",id:"quality-of-service-qos-settings",level:3},{value:"Assessment",id:"assessment",level:2},{value:"Recall",id:"recall",level:3},{value:"Apply",id:"apply",level:3},{value:"Analyze",id:"analyze",level:3}];function c(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"week-3-ros-2-architecture",children:"Week 3: ROS 2 Architecture"})}),"\n",(0,r.jsx)(n.h2,{id:"learning-outcomes",children:"Learning Outcomes"}),"\n",(0,r.jsx)(n.p,{children:"By the end of this chapter, you should be able to:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Explain the ROS 2 architecture and its role in robotics"}),"\n",(0,r.jsx)(n.li,{children:"Understand the DDS (Data Distribution Service) middleware"}),"\n",(0,r.jsx)(n.li,{children:"Create and run ROS 2 nodes using Python (rclpy)"}),"\n",(0,r.jsx)(n.li,{children:"Implement publishers and subscribers for robot communication"}),"\n",(0,r.jsx)(n.li,{children:"Use ROS 2 command-line tools for debugging"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"the-physics-why",children:"The Physics (Why)"}),"\n",(0,r.jsx)(n.p,{children:"A humanoid robot is not a single program\u2014it's a complex system of interconnected components:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Sensors"})," producing data at different rates"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Controllers"})," running at high frequencies for stability"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Planners"})," computing trajectories"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Safety monitors"})," watching for dangerous conditions"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["These components must communicate reliably, in real-time, and often across multiple computers. ",(0,r.jsx)(n.strong,{children:"ROS 2"})," (Robot Operating System 2) provides the middleware that makes this possible."]}),"\n",(0,r.jsx)(n.p,{children:"Without ROS 2, you would need to:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Write custom networking code for every component"}),"\n",(0,r.jsx)(n.li,{children:"Handle message serialization manually"}),"\n",(0,r.jsx)(n.li,{children:"Implement your own discovery mechanisms"}),"\n",(0,r.jsx)(n.li,{children:"Build debugging and visualization tools from scratch"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"ROS 2 solves these problems with a standardized, battle-tested framework."}),"\n",(0,r.jsx)(n.h2,{id:"the-analogy-mental-model",children:"The Analogy (Mental Model)"}),"\n",(0,r.jsxs)(n.p,{children:["Think of ROS 2 like a ",(0,r.jsx)(n.strong,{children:"postal system"})," for robots:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Nodes"})," are like offices that send and receive mail"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Topics"})," are like mailing addresses\u2014anyone can send to or receive from an address"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Messages"})," are like letters with standardized formats"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Services"})," are like registered mail\u2014you send a request and wait for a response"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Actions"})," are like package tracking\u2014long-running tasks with progress updates"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.strong,{children:"DDS middleware"})," is like the postal infrastructure\u2014it handles routing, delivery, and ensures messages arrive reliably."]}),"\n",(0,r.jsx)(n.h2,{id:"the-visualization-ros-2-graph",children:"The Visualization (ROS 2 Graph)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mermaid",children:'graph LR\n    subgraph "Sensor Nodes"\n        A[Camera Node] --\x3e|/image_raw| D[Topic]\n        B[LiDAR Node] --\x3e|/scan| E[Topic]\n        C[IMU Node] --\x3e|/imu| F[Topic]\n    end\n    \n    subgraph "Processing Nodes"\n        D --\x3e G[Vision Node]\n        E --\x3e H[SLAM Node]\n        F --\x3e H\n        G --\x3e|/detections| I[Topic]\n        H --\x3e|/map| J[Topic]\n        H --\x3e|/odom| K[Topic]\n    end\n    \n    subgraph "Control Nodes"\n        I --\x3e L[Planner Node]\n        J --\x3e L\n        K --\x3e L\n        L --\x3e|/cmd_vel| M[Topic]\n        M --\x3e N[Motor Controller]\n    end\n'})}),"\n",(0,r.jsx)(n.h2,{id:"the-code-implementation",children:"The Code (Implementation)"}),"\n",(0,r.jsx)(n.h3,{id:"your-first-ros-2-node",children:"Your First ROS 2 Node"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\n"""\nminimal_node.py - A minimal ROS 2 node demonstrating basic structure.\n\nThis node simply logs a message periodically to show the node lifecycle.\n"""\n\nimport rclpy\nfrom rclpy.node import Node\n\n\nclass MinimalNode(Node):\n    """\n    A minimal ROS 2 node that demonstrates the basic structure.\n    \n    All ROS 2 nodes inherit from rclpy.node.Node and must call\n    the parent constructor with a unique node name.\n    """\n    \n    def __init__(self):\n        # Initialize the node with a unique name\n        super().__init__(\'minimal_node\')\n        \n        # Create a timer that fires every 1 second\n        self.timer = self.create_timer(1.0, self.timer_callback)\n        self.counter = 0\n        \n        # Log that the node has started\n        self.get_logger().info(\'Minimal node has started!\')\n    \n    def timer_callback(self):\n        """Called every time the timer fires."""\n        self.counter += 1\n        self.get_logger().info(f\'Timer fired {self.counter} times\')\n\n\ndef main(args=None):\n    """Main entry point for the node."""\n    # Initialize the ROS 2 Python client library\n    rclpy.init(args=args)\n    \n    # Create an instance of our node\n    node = MinimalNode()\n    \n    try:\n        # Spin the node so callbacks are called\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        # Clean up\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,r.jsx)(n.h3,{id:"publisher-node",children:"Publisher Node"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\n"""\npublisher_node.py - Publishes sensor data to a topic.\n\nDemonstrates the publisher pattern in ROS 2.\n"""\n\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import Float64\nfrom geometry_msgs.msg import Twist\nimport math\n\n\nclass SensorPublisher(Node):\n    """\n    Publishes simulated sensor data.\n    \n    In a real robot, this would read from actual hardware.\n    """\n    \n    def __init__(self):\n        super().__init__(\'sensor_publisher\')\n        \n        # Create publishers for different data types\n        # QoS depth of 10 means buffer up to 10 messages\n        self.temperature_pub = self.create_publisher(\n            Float64,           # Message type\n            \'/sensor/temperature\',  # Topic name\n            10                 # QoS depth\n        )\n        \n        self.velocity_pub = self.create_publisher(\n            Twist,\n            \'/cmd_vel\',\n            10\n        )\n        \n        # Timer to publish at 10 Hz\n        self.timer = self.create_timer(0.1, self.publish_data)\n        self.time = 0.0\n        \n        self.get_logger().info(\'Sensor publisher started\')\n    \n    def publish_data(self):\n        """Publish sensor readings."""\n        self.time += 0.1\n        \n        # Publish temperature (simulated sine wave)\n        temp_msg = Float64()\n        temp_msg.data = 25.0 + 5.0 * math.sin(self.time)\n        self.temperature_pub.publish(temp_msg)\n        \n        # Publish velocity command\n        vel_msg = Twist()\n        vel_msg.linear.x = 0.5  # Forward at 0.5 m/s\n        vel_msg.angular.z = 0.1 * math.sin(self.time)  # Gentle turning\n        self.velocity_pub.publish(vel_msg)\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = SensorPublisher()\n    \n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,r.jsx)(n.h3,{id:"subscriber-node",children:"Subscriber Node"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\n"""\nsubscriber_node.py - Subscribes to topics and processes data.\n\nDemonstrates the subscriber pattern in ROS 2.\n"""\n\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import Float64\nfrom geometry_msgs.msg import Twist\n\n\nclass DataSubscriber(Node):\n    """\n    Subscribes to sensor data and processes it.\n    \n    This pattern is used for monitoring, logging, and control.\n    """\n    \n    def __init__(self):\n        super().__init__(\'data_subscriber\')\n        \n        # Subscribe to temperature\n        self.temp_sub = self.create_subscription(\n            Float64,\n            \'/sensor/temperature\',\n            self.temperature_callback,\n            10\n        )\n        \n        # Subscribe to velocity commands\n        self.vel_sub = self.create_subscription(\n            Twist,\n            \'/cmd_vel\',\n            self.velocity_callback,\n            10\n        )\n        \n        # Track statistics\n        self.temp_readings = []\n        self.max_speed = 0.0\n        \n        self.get_logger().info(\'Data subscriber started\')\n    \n    def temperature_callback(self, msg: Float64):\n        """Process temperature readings."""\n        temp = msg.data\n        self.temp_readings.append(temp)\n        \n        # Keep only last 100 readings\n        if len(self.temp_readings) > 100:\n            self.temp_readings.pop(0)\n        \n        # Calculate average\n        avg_temp = sum(self.temp_readings) / len(self.temp_readings)\n        \n        # Log periodically\n        if len(self.temp_readings) % 10 == 0:\n            self.get_logger().info(\n                f\'Temperature: {temp:.1f}\xb0C (avg: {avg_temp:.1f}\xb0C)\'\n            )\n    \n    def velocity_callback(self, msg: Twist):\n        """Process velocity commands."""\n        speed = abs(msg.linear.x)\n        \n        if speed > self.max_speed:\n            self.max_speed = speed\n            self.get_logger().info(f\'New max speed: {speed:.2f} m/s\')\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = DataSubscriber()\n    \n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,r.jsx)(n.h3,{id:"ros-2-command-line-tools",children:"ROS 2 Command-Line Tools"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# List all running nodes\nros2 node list\n\n# Get info about a specific node\nros2 node info /sensor_publisher\n\n# List all topics\nros2 topic list\n\n# Show topic message type\nros2 topic info /cmd_vel\n\n# Echo messages on a topic (great for debugging)\nros2 topic echo /sensor/temperature\n\n# Publish a test message\nros2 topic pub /cmd_vel geometry_msgs/msg/Twist \\\n  "{linear: {x: 0.5}, angular: {z: 0.1}}"\n\n# Check publishing rate\nros2 topic hz /sensor/temperature\n'})}),"\n",(0,r.jsx)(n.h2,{id:"the-hardware-reality-warning",children:"The Hardware Reality (Warning)"}),"\n",(0,r.jsxs)(n.admonition,{title:"Network Configuration",type:"warning",children:[(0,r.jsx)(n.p,{children:"ROS 2 uses DDS for communication, which relies on multicast networking. Common issues:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Firewall blocking"}),": Disable firewall or add ROS 2 exceptions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Multiple network interfaces"}),": Set ",(0,r.jsx)(n.code,{children:"ROS_DOMAIN_ID"})," to isolate traffic"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Wi-Fi latency"}),": Use wired Ethernet for real-time control"]}),"\n"]})]}),"\n",(0,r.jsx)(n.h3,{id:"quality-of-service-qos-settings",children:"Quality of Service (QoS) Settings"}),"\n",(0,r.jsx)(n.p,{children:"QoS determines how messages are delivered:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from rclpy.qos import QoSProfile, ReliabilityPolicy, HistoryPolicy\n\n# For sensor data: best effort, keep latest\nsensor_qos = QoSProfile(\n    reliability=ReliabilityPolicy.BEST_EFFORT,\n    history=HistoryPolicy.KEEP_LAST,\n    depth=1\n)\n\n# For commands: reliable delivery\ncommand_qos = QoSProfile(\n    reliability=ReliabilityPolicy.RELIABLE,\n    history=HistoryPolicy.KEEP_LAST,\n    depth=10\n)\n"})}),"\n",(0,r.jsxs)(n.admonition,{title:"Real-Time Constraints",type:"danger",children:[(0,r.jsx)(n.p,{children:"ROS 2 nodes run in user space and are not real-time by default. For safety-critical control:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"ros2_control"})," with real-time controllers"]}),"\n",(0,r.jsx)(n.li,{children:"Consider running on a real-time Linux kernel (PREEMPT_RT)"}),"\n",(0,r.jsx)(n.li,{children:"Keep control loops in dedicated high-priority threads"}),"\n"]})]}),"\n",(0,r.jsx)(n.h2,{id:"assessment",children:"Assessment"}),"\n",(0,r.jsx)(n.h3,{id:"recall",children:"Recall"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"What is the role of DDS in ROS 2?"}),"\n",(0,r.jsx)(n.li,{children:"What is the difference between a topic and a service?"}),"\n",(0,r.jsx)(n.li,{children:"How do you create a timer in a ROS 2 node?"}),"\n",(0,r.jsx)(n.li,{children:"What command shows all active topics?"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"apply",children:"Apply"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Create a ROS 2 node that:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Subscribes to ",(0,r.jsx)(n.code,{children:"/imu"})," (sensor_msgs/Imu)"]}),"\n",(0,r.jsx)(n.li,{children:"Calculates the robot's tilt angle"}),"\n",(0,r.jsxs)(n.li,{children:["Publishes a warning to ",(0,r.jsx)(n.code,{children:"/safety/tilt_warning"})," if tilt > 15\xb0"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Write a launch file that starts both a publisher and subscriber node with configurable parameters."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Implement a node that logs all messages on ",(0,r.jsx)(n.code,{children:"/cmd_vel"})," to a CSV file for later analysis."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"analyze",children:"Analyze"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Why might you choose ",(0,r.jsx)(n.code,{children:"BEST_EFFORT"})," QoS for camera images but ",(0,r.jsx)(n.code,{children:"RELIABLE"})," for emergency stop commands?"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"A robot has 10 sensor nodes each publishing at 100 Hz. Calculate the total message throughput and discuss potential bottlenecks."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Compare the trade-offs between using topics vs. services for robot arm position commands."}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var i=s(6540);const r={},t=i.createContext(r);function o(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);
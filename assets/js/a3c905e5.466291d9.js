"use strict";(globalThis.webpackChunkphysical_ai_textbook=globalThis.webpackChunkphysical_ai_textbook||[]).push([[848],{8035:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"module1/week4-ros-fundamentals-2","title":"ROS 2 Communication Patterns","description":"Services, actions, and advanced communication patterns for robot control","source":"@site/docs/module1/week4-ros-fundamentals-2.md","sourceDirName":"module1","slug":"/module1/week4-ros-fundamentals-2","permalink":"/physical-ai-and-humanoid-robotics/docs/module1/week4-ros-fundamentals-2","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"ROS 2 Communication Patterns","description":"Services, actions, and advanced communication patterns for robot control","keywords":["ros2","services","actions","communication","rclpy"]},"sidebar":"tutorialSidebar","previous":{"title":"ROS 2 Architecture","permalink":"/physical-ai-and-humanoid-robotics/docs/module1/week3-ros-fundamentals"},"next":{"title":"ROS 2 Packages and Launch Files","permalink":"/physical-ai-and-humanoid-robotics/docs/module1/week5-ros-fundamentals-3"}}');var r=t(4848),o=t(8453);const i={sidebar_position:4,title:"ROS 2 Communication Patterns",description:"Services, actions, and advanced communication patterns for robot control",keywords:["ros2","services","actions","communication","rclpy"]},a="Week 4: ROS 2 Communication Patterns",l={},c=[{value:"Learning Outcomes",id:"learning-outcomes",level:2},{value:"The Physics (Why)",id:"the-physics-why",level:2},{value:"The Analogy (Mental Model)",id:"the-analogy-mental-model",level:2},{value:"The Visualization (Communication Patterns)",id:"the-visualization-communication-patterns",level:2},{value:"The Code (Implementation)",id:"the-code-implementation",level:2},{value:"Service Server",id:"service-server",level:3},{value:"Service Client",id:"service-client",level:3},{value:"Action Server (Navigation Example)",id:"action-server-navigation-example",level:3},{value:"The Hardware Reality (Warning)",id:"the-hardware-reality-warning",level:2},{value:"Assessment",id:"assessment",level:2},{value:"Recall",id:"recall",level:3},{value:"Apply",id:"apply",level:3},{value:"Analyze",id:"analyze",level:3}];function d(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"week-4-ros-2-communication-patterns",children:"Week 4: ROS 2 Communication Patterns"})}),"\n",(0,r.jsx)(n.h2,{id:"learning-outcomes",children:"Learning Outcomes"}),"\n",(0,r.jsx)(n.p,{children:"By the end of this chapter, you should be able to:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Implement ROS 2 services for request-response communication"}),"\n",(0,r.jsx)(n.li,{children:"Use actions for long-running tasks with feedback"}),"\n",(0,r.jsx)(n.li,{children:"Choose the appropriate communication pattern for different scenarios"}),"\n",(0,r.jsx)(n.li,{children:"Handle errors and timeouts in ROS 2 communication"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"the-physics-why",children:"The Physics (Why)"}),"\n",(0,r.jsx)(n.p,{children:"Topics work well for continuous data streams, but robots also need:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Request-response"}),': "What is the current battery level?" \u2192 "85%"']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Long-running tasks"}),': "Navigate to the kitchen" \u2192 progress updates \u2192 "Arrived"']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cancellable operations"}),': "Stop moving!" during navigation']}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["ROS 2 provides ",(0,r.jsx)(n.strong,{children:"Services"})," and ",(0,r.jsx)(n.strong,{children:"Actions"})," for these patterns."]}),"\n",(0,r.jsx)(n.h2,{id:"the-analogy-mental-model",children:"The Analogy (Mental Model)"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Pattern"}),(0,r.jsx)(n.th,{children:"Real-World Analogy"}),(0,r.jsx)(n.th,{children:"Use Case"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Topic"})}),(0,r.jsx)(n.td,{children:"Radio broadcast"}),(0,r.jsx)(n.td,{children:"Sensor data, continuous streams"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Service"})}),(0,r.jsx)(n.td,{children:"Phone call"}),(0,r.jsx)(n.td,{children:"Quick queries, configuration"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Action"})}),(0,r.jsx)(n.td,{children:"Food delivery app"}),(0,r.jsx)(n.td,{children:"Long tasks with tracking"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"the-visualization-communication-patterns",children:"The Visualization (Communication Patterns)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mermaid",children:"sequenceDiagram\n    participant C as Client\n    participant S as Server\n    \n    Note over C,S: Service Pattern\n    C->>S: Request\n    S->>C: Response\n    \n    Note over C,S: Action Pattern\n    C->>S: Goal\n    S->>C: Feedback\n    S->>C: Feedback\n    S->>C: Result\n"})}),"\n",(0,r.jsx)(n.h2,{id:"the-code-implementation",children:"The Code (Implementation)"}),"\n",(0,r.jsx)(n.h3,{id:"service-server",children:"Service Server"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\n"""\nService server for robot configuration queries.\n"""\n\nimport rclpy\nfrom rclpy.node import Node\nfrom std_srvs.srv import SetBool, Trigger\nfrom example_interfaces.srv import AddTwoInts\n\n\nclass RobotConfigService(Node):\n    """Provides configuration services for the robot."""\n    \n    def __init__(self):\n        super().__init__(\'robot_config_service\')\n        \n        # Service to enable/disable motors\n        self.motor_srv = self.create_service(\n            SetBool,\n            \'/robot/enable_motors\',\n            self.enable_motors_callback\n        )\n        \n        # Service to get robot status\n        self.status_srv = self.create_service(\n            Trigger,\n            \'/robot/get_status\',\n            self.get_status_callback\n        )\n        \n        self.motors_enabled = False\n        self.get_logger().info(\'Robot config service ready\')\n    \n    def enable_motors_callback(\n        self,\n        request: SetBool.Request,\n        response: SetBool.Response\n    ) -> SetBool.Response:\n        """Handle motor enable/disable requests."""\n        self.motors_enabled = request.data\n        \n        response.success = True\n        response.message = (\n            \'Motors enabled\' if self.motors_enabled else \'Motors disabled\'\n        )\n        \n        self.get_logger().info(response.message)\n        return response\n    \n    def get_status_callback(\n        self,\n        request: Trigger.Request,\n        response: Trigger.Response\n    ) -> Trigger.Response:\n        """Return current robot status."""\n        response.success = True\n        response.message = f\'Motors: {"ON" if self.motors_enabled else "OFF"}\'\n        return response\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = RobotConfigService()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,r.jsx)(n.h3,{id:"service-client",children:"Service Client"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\n"""\nService client demonstrating synchronous and async calls.\n"""\n\nimport rclpy\nfrom rclpy.node import Node\nfrom std_srvs.srv import SetBool, Trigger\n\n\nclass RobotController(Node):\n    """Controls robot via services."""\n    \n    def __init__(self):\n        super().__init__(\'robot_controller\')\n        \n        # Create service clients\n        self.motor_client = self.create_client(\n            SetBool,\n            \'/robot/enable_motors\'\n        )\n        \n        self.status_client = self.create_client(\n            Trigger,\n            \'/robot/get_status\'\n        )\n        \n        # Wait for services to be available\n        while not self.motor_client.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info(\'Waiting for motor service...\')\n    \n    def enable_motors(self, enable: bool) -> bool:\n        """Enable or disable motors (blocking call)."""\n        request = SetBool.Request()\n        request.data = enable\n        \n        future = self.motor_client.call_async(request)\n        rclpy.spin_until_future_complete(self, future)\n        \n        result = future.result()\n        self.get_logger().info(f\'Motor service: {result.message}\')\n        return result.success\n    \n    def get_status(self) -> str:\n        """Get robot status."""\n        request = Trigger.Request()\n        future = self.status_client.call_async(request)\n        rclpy.spin_until_future_complete(self, future)\n        return future.result().message\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    controller = RobotController()\n    \n    # Enable motors\n    controller.enable_motors(True)\n    \n    # Check status\n    status = controller.get_status()\n    print(f\'Robot status: {status}\')\n    \n    controller.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,r.jsx)(n.h3,{id:"action-server-navigation-example",children:"Action Server (Navigation Example)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\n"""\nAction server for robot navigation with progress feedback.\n"""\n\nimport time\nimport rclpy\nfrom rclpy.node import Node\nfrom rclpy.action import ActionServer, GoalResponse, CancelResponse\nfrom rclpy.action.server import ServerGoalHandle\nfrom example_interfaces.action import Fibonacci  # Using as placeholder\n\n\nclass NavigationServer(Node):\n    """Handles navigation goals with feedback."""\n    \n    def __init__(self):\n        super().__init__(\'navigation_server\')\n        \n        self._action_server = ActionServer(\n            self,\n            Fibonacci,  # In real code: NavigateToPose\n            \'navigate\',\n            execute_callback=self.execute_callback,\n            goal_callback=self.goal_callback,\n            cancel_callback=self.cancel_callback\n        )\n        \n        self.get_logger().info(\'Navigation server ready\')\n    \n    def goal_callback(self, goal_request) -> GoalResponse:\n        """Accept or reject incoming goals."""\n        self.get_logger().info(\'Received navigation goal\')\n        return GoalResponse.ACCEPT\n    \n    def cancel_callback(self, goal_handle: ServerGoalHandle) -> CancelResponse:\n        """Handle cancellation requests."""\n        self.get_logger().info(\'Received cancel request\')\n        return CancelResponse.ACCEPT\n    \n    async def execute_callback(\n        self,\n        goal_handle: ServerGoalHandle\n    ) -> Fibonacci.Result:\n        """Execute the navigation goal with feedback."""\n        self.get_logger().info(\'Executing navigation...\')\n        \n        feedback_msg = Fibonacci.Feedback()\n        \n        # Simulate navigation progress\n        for i in range(10):\n            if goal_handle.is_cancel_requested:\n                goal_handle.canceled()\n                self.get_logger().info(\'Navigation canceled\')\n                return Fibonacci.Result()\n            \n            # Send progress feedback\n            feedback_msg.partial_sequence = [i * 10]  # % complete\n            goal_handle.publish_feedback(feedback_msg)\n            self.get_logger().info(f\'Progress: {i * 10}%\')\n            \n            time.sleep(0.5)  # Simulate movement\n        \n        goal_handle.succeed()\n        \n        result = Fibonacci.Result()\n        result.sequence = [100]  # Complete\n        return result\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = NavigationServer()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,r.jsx)(n.h2,{id:"the-hardware-reality-warning",children:"The Hardware Reality (Warning)"}),"\n",(0,r.jsxs)(n.admonition,{title:"Service Timeouts",type:"warning",children:[(0,r.jsx)(n.p,{children:"Services can hang if the server crashes. Always use timeouts:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"future = client.call_async(request)\nrclpy.spin_until_future_complete(self, future, timeout_sec=5.0)\nif not future.done():\n    self.get_logger().error('Service call timed out!')\n"})})]}),"\n",(0,r.jsx)(n.admonition,{title:"Action Cancellation",type:"danger",children:(0,r.jsx)(n.p,{children:"Always implement proper cancellation handling. A robot that can't stop is dangerous!"})}),"\n",(0,r.jsx)(n.h2,{id:"assessment",children:"Assessment"}),"\n",(0,r.jsx)(n.h3,{id:"recall",children:"Recall"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"When should you use a service vs. a topic?"}),"\n",(0,r.jsx)(n.li,{children:"What are the three components of an action (goal, feedback, result)?"}),"\n",(0,r.jsx)(n.li,{children:"How do you handle service timeouts?"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"apply",children:"Apply"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Create a service that returns the robot's battery percentage."}),"\n",(0,r.jsx)(n.li,{children:'Implement an action server for a "pick and place" task with progress feedback.'}),"\n",(0,r.jsx)(n.li,{children:"Write a client that cancels navigation if battery drops below 20%."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"analyze",children:"Analyze"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Why are actions better than services for navigation tasks?"}),"\n",(0,r.jsx)(n.li,{children:"What happens if a service server crashes mid-request?"}),"\n",(0,r.jsx)(n.li,{children:"Design the communication architecture for a robot arm with 6 joints."}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>a});var s=t(6540);const r={},o=s.createContext(r);function i(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);